{% load static %}
<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
<meta charset="UTF-8">
<title>ØªØ·Ø¨ÙŠÙ‚ Ø§Ù„Ø·Ù‚Ø³ Ø§Ù„Ù…ØªÙ‚Ø¯Ù…</title>
<link rel="manifest" href="{% static 'manifest.json' %}">
<link rel="icon" href="{% static 'icons/icon-192.png' %}">
<meta name="theme-color" content="#00ffff">
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<style>
body{
    font-family: Arial;
    margin:0;
    padding:20px 0 80px 0;
    background: linear-gradient(to right,#74ebd5,#9face6);
    transition:0.4s;
}

body.dark{
    background:#111;
    color:#eee;
}

.container{
    width:90%;
    max-width:900px;
    margin:auto;
}

/* Ø§Ù„Ø¨Ø­Ø« */
.search-box{text-align:center;margin-bottom:15px;}
.search-box input{
    padding:12px;
    width:60%;
    border-radius:10px;
    border:none;
    font-size:16px;
}
.search-box button{
    padding:12px 18px;
    border:none;
    border-radius:10px;
    background:#222;
    color:#fff;
    cursor:pointer;
}

/* Ù…Ø¯Ù† Ø³Ø±ÙŠØ¹Ø© */
.quick-cities{text-align:center;margin-bottom:15px;}
.quick-cities button{
    margin:5px;
    padding:8px 15px;
    border:none;
    border-radius:20px;
    background:#fff;
    font-weight:bold;
    cursor:pointer;
    transition:0.3s;
}
.quick-cities button:hover{
    background:#00c3ff;
    color:#000;
}
body.dark .quick-cities button{
    background:#333;
    color:#fff;
}
body.dark .quick-cities button:hover{
    background:#00c3ff;
    color:#000;
}

/* Ø§Ù„ÙƒØ§Ø±Øª Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠ */
.main-card{
    background:rgba(255,255,255,0.95);
    padding:20px;
    border-radius:15px;
    text-align:center;
    margin-bottom:20px;
    transition:0.3s;
}
body.dark .main-card{background:#222;}
.main-card img{width:80px}

/* Ø§Ù„Ø¹Ù†ÙˆØ§Ù† Ø¨Ø§Ù„Ø¹Ø±Ø¶ Ù„Ù„ÙƒØ§Ø±Øª Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠ */
.main-card .title-box{
    width:100%;
    background:#1a1a1a;
    color:cyan;
    padding:4px 8px;
    border-radius:12px 12px 0 0;
    margin:-20px -20px 12px -20px;
    font-size:16px;
    font-weight:500;
}

/* Grid */
.grid{
    display:grid;
    grid-template-columns:repeat(auto-fit,minmax(250px,1fr));
    gap:15px;
}

.box{
    background:rgba(255,255,255,0.95);
    padding:18px;
    border-radius:18px;
    transition:0.3s;
    box-shadow:0 8px 20px rgba(0,0,0,0.1);
}

body.dark .box{
    background:#222;
    box-shadow:0 8px 20px rgba(0,0,0,0.5);
}

.wind-arrow{
    display:inline-block;
    font-size:22px;
    transition: transform 0.4s ease;
}

/* Ø§Ù„Ø¹Ù†ÙˆØ§Ù† Ø¨Ø§Ù„Ø¹Ø±Ø¶ Ù„Ù„ÙƒØ±ÙˆØª */
.box .title-box{
    width:100%;
    background:#1a1a1a;
    color:cyan;
    padding:4px 6px;
    border-radius:10px 10px 0 0;
    margin:-15px -15px 8px -15px;
    font-size:14px;
    font-weight:500;
}

/* ØªÙˆÙ‚Ø¹Ø§Øª */
.forecast{
    display:flex;
    gap:15px;
    justify-content:space-between;
    margin-top:20px;
    flex-wrap:wrap;
}

.forecast-day{
    flex:1;
    min-width:120px;
    background:rgba(255,255,255,0.9);
    padding:10px;
    border-radius:12px;
    text-align:center;
    transition: transform 0.3s, box-shadow 0.3s;
}
.forecast-day:hover{
    transform: translateY(-5px);
    box-shadow:0 5px 15px rgba(0,0,0,0.2);
}
body.dark .forecast-day{background:#222}

/* Ø§Ù„Ø¹Ù†ÙˆØ§Ù† Ø¯Ø§Ø®Ù„ ÙƒÙ„ ÙŠÙˆÙ… */
.forecast-day .title-box{
    display:block;
    background:#000;
    color: cyan;
    padding:5px 8px;
    border-radius:5px;
    margin-bottom:8px;
}

/* Ø²Ø± Ø¯Ø§Ø±Ùƒ Ù…ÙˆØ¯ */
.mode-toggle{
    position:fixed;
    top:15px;
    right:15px;
    cursor:pointer;
    font-size:22px;
}

/* Loading Spinner */
.spinner-overlay{
    position:fixed;
    top:0;
    left:0;
    width:100%;
    height:100%;
    background:rgba(0,0,0,0.4);
    display:none;
    justify-content:center;
    align-items:center;
    z-index:9999;
}

.spinner{
    width:60px;
    height:60px;
    border:6px solid #eee;
    border-top:6px solid #00c3ff;
    border-radius:50%;
    animation:spin 1s linear infinite;
}

@keyframes spin{
    0%{transform:rotate(0deg);}
    100%{transform:rotate(360deg);}
}

@media (max-width: 600px){
.search-box input{
    width:90%;
    margin-bottom:10px;
}
.search-box button{
    width:90%;
    margin-top:5px;
}
.forecast{
    flex-direction:column;
}
.forecast-day{
    width:100%;
}
.quick-cities button{
    width:45%;
    margin:5px 2%;
}
}

/* Ù†Ø§Ù Ø¨Ø§Ø± Ø³ÙÙ„ÙŠ */
.bottom-nav{
    position: fixed;
    bottom: 0;
    width: 100%;
    background: #222;
    color: white;
    display: flex;
    justify-content: space-around;
    align-items: center;
    height: 60px;
    font-size: 20px;
}
.bottom-nav div{
    display: flex;
    flex-direction: column;
    align-items: center;
}
.bottom-nav span{
    font-size: 14px;
}
</style>

<script>
if ('serviceWorker' in navigator) {
  navigator.serviceWorker.register("{% static 'sw.js' %}")
    .then(function() {
      console.log("Service Worker Registered");
    });
}
</script>
</head>

<body>

<div class="mode-toggle" onclick="toggleMode()" id="mode-icon">ğŸŒ™</div>

<div class="container">

<!-- Ø§Ù„Ø¨Ø­Ø« -->
<form method="POST" class="search-box">
    {% csrf_token %}
    <input type="text" name="city" id="cityInput" placeholder="Ø§ÙƒØªØ¨ Ø§Ø³Ù… Ø§Ù„Ù…Ø¯ÙŠÙ†Ø©..." required autofocus>
    <button type="submit">Ø¨Ø­Ø«</button>
    <button type="button" onclick="getLocation()">ğŸ“ Ù…ÙˆÙ‚Ø¹ÙŠ</button>
</form>

<!-- Ù…Ø¯Ù† Ø«Ø§Ø¨ØªØ© -->
<div class="quick-cities">
<form method="POST" style="display:inline;">{% csrf_token %}
<input type="hidden" name="city" value="Cairo">
<button type="submit">Ø§Ù„Ù‚Ø§Ù‡Ø±Ø©</button></form>

<form method="POST" style="display:inline;">{% csrf_token %}
<input type="hidden" name="city" value="Mecca">
<button type="submit">Ù…ÙƒØ©</button></form>

<form method="POST" style="display:inline;">{% csrf_token %}
<input type="hidden" name="city" value="London">
<button type="submit">London</button></form>
</div>

{% if city_weather %}
{% if error %}
<div style="background:#ff4d4d;color:white;padding:10px;border-radius:10px;text-align:center;margin-bottom:15px;">
    {{ error }}
</div>
{% endif %}

<!-- Ø§Ù„ÙƒØ§Ø±Øª Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠ -->
<div class="main-card">
<div class="title-box">
<h2>{{city_weather.city}} - {{city_weather.region}}</h2>
</div>
<p>{{city_weather.country}} | {{city_weather.tz_id}}</p>
{% if city_weather.icon %}
<img src="https:{{city_weather.icon}}">
{% endif %}

<h1>{{city_weather.temp_c}}Â°C</h1>
<p>{{city_weather.text}}</p>
<p>Ø§Ù„Ø­Ø§Ù„Ø© Ø§Ù„Ø¬ÙˆÙŠØ©: {{city_weather.aqi_description}}</p>
<small>ğŸ•’ {{city_weather.localtime}}</small>
</div>

<div class="grid">

  <!-- ÙƒØ§Ø±Øª Ø§Ù„Ø­Ø±Ø§Ø±Ø© -->
  <div class="box">
    <div class="title-box"><h3>ğŸŒ¡ Ø§Ù„Ø­Ø±Ø§Ø±Ø©</h3></div>
    <p>Ø§Ù„Ù…Ø­Ø³ÙˆØ³Ø©: {{city_weather.feelslike_c}}Â°C</p>
    <p>Ø§Ù„Ø±Ø·ÙˆØ¨Ø©: {{city_weather.humidity}}%</p>
    <p>Ø§Ù„Ø³Ø­Ø¨: {{city_weather.cloud}}%</p>
  </div>

  <!-- ÙƒØ§Ø±Øª Ø§Ù„Ø¶ØºØ· ÙˆØ§Ù„Ø±Ø¤ÙŠØ© -->
  <div class="box">
    <div class="title-box"><h3>ğŸŒ§ Ø§Ù„Ø¶ØºØ· ÙˆØ§Ù„Ø±Ø¤ÙŠØ©</h3></div>
    <p>Ø§Ù„Ø¶ØºØ·: {{city_weather.pressure_mb}} mb</p>
    <p>Ø§Ù„Ø±Ø¤ÙŠØ©: {{city_weather.vis_km}} ÙƒÙ…</p>
    <p>UV: {{city_weather.uv}}</p>
  </div>

  <!-- ÙƒØ§Ø±Øª Ø§Ù„Ø±ÙŠØ§Ø­ ÙˆØ§Ù„Ø£Ù…Ø·Ø§Ø± -->
  <div class="box">
    <div class="title-box"><h3>ğŸŒ¬ Ø§Ù„Ø±ÙŠØ§Ø­ ÙˆØ§Ù„Ø£Ù…Ø·Ø§Ø±</h3></div>

    <p>
      Ø³Ø±Ø¹Ø© Ø§Ù„Ø±ÙŠØ§Ø­:
      <span style="
        color:
        {% if city_weather.wind_kph < 20 %}green
        {% elif city_weather.wind_kph < 40 %}orange
        {% else %}red
        {% endif %};
      ">
        {{city_weather.wind_kph}} ÙƒÙ…/Ø³
      </span>
    </p>

    <p>Ù‡Ø¨Ø§Øª Ø§Ù„Ø±ÙŠØ§Ø­: {{city_weather.gust_kph}} ÙƒÙ…/Ø³</p>

    <p>
      Ø§Ù„Ø§ØªØ¬Ø§Ù‡:
      <span class="wind-arrow" style="transform: rotate({{city_weather.wind_degree}}deg);">
        â¬†
      </span>
      {{city_weather.wind_dir}}
    </p>

    {% if city_weather.precip_mm > 0 %}
    <hr>
    <p>ğŸŒ§ Ø§Ù„Ø£Ù…Ø·Ø§Ø±: {{city_weather.precip_mm}} Ù…Ù…</p>
    {% endif %}

  </div>

</div> <!-- Ù†Ù‡Ø§ÙŠØ© Ø§Ù„Ù€ grid -->

<!-- Ø§Ù„ØªÙˆÙ‚Ø¹Ø§Øª Ù„Ø«Ù„Ø§Ø« Ø£ÙŠØ§Ù… Ù‚Ø§Ø¯Ù…Ø© -->
{% if forecast_days %}
<div class="forecast">
{% for day in forecast_days %}
<div class="forecast-day">
<div class="title-box">{{ day.day_name }}</div>
<p>{{ day.date }}</p>
<img src="https:{{day.day.condition.icon}}">
<p>{{day.day.maxtemp_c}}Â° / {{day.day.mintemp_c}}Â°</p>
<p>{{day.day.condition.text}}</p>
</div>
{% endfor %}
</div>
{% endif %}

{% endif %}

</div>

<!-- ÙÙˆØªØ± Ø§Ù„Ø·Ù‚Ø³ -->
<div class="bottom-nav">
    <div>â˜€ï¸<span>Ù…Ø´Ù…Ø³</span></div>
    <div>â˜ï¸<span>ØºØ§Ø¦Ù…</span></div>
    <div>ğŸŒ§ï¸<span>Ù…Ù…Ø·Ø±</span></div>
    <div>â„ï¸<span>Ø¨Ø§Ø±Ø¯</span></div>
    <div>ğŸŒ©ï¸<span>Ø¹ÙˆØ§ØµÙ</span></div>
</div>

<!-- Loading -->
<div class="spinner-overlay" id="loadingSpinner">
    <div class="spinner"></div>
</div>

<script>
function toggleMode(){
document.body.classList.toggle('dark');
let icon=document.getElementById('mode-icon');
icon.textContent=document.body.classList.contains('dark')?'â˜€ï¸':'ğŸŒ™';
}

/* Ø­ÙØ¸ Ø¢Ø®Ø± Ù…Ø¯ÙŠÙ†Ø© */
if(localStorage.getItem("lastCity")){
document.getElementById("cityInput").value=localStorage.getItem("lastCity");
}

/* Ø¥Ø¸Ù‡Ø§Ø± Ø§Ù„Ù„ÙˆØ¯Ù†Ø¬ */
document.querySelector("form").addEventListener("submit",function(){
document.getElementById("loadingSpinner").style.display="flex";
localStorage.setItem("lastCity", document.getElementById("cityInput").value);
});

/* ØªØ­Ø¯ÙŠØ¯ Ø§Ù„Ù…ÙˆÙ‚Ø¹ */
function getLocation(){
if(navigator.geolocation){
navigator.geolocation.getCurrentPosition(function(position){
document.getElementById("cityInput").value=
position.coords.latitude + "," + position.coords.longitude;
});
}
}
</script>

</body>
</html>
